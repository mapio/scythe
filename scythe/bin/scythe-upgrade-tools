mkdir -p "$SCYTHE_HOME/.support_tools_cache"

cd "$SCYTHE_HOME/.support_tools_cache"
for repo in tristo-mietitore sim-fun-i scythe-viewer; do
    if [ ! -d $repo ]; then
        echo1 "Cloning $repo"
        git clone https://github.com/mapio/$repo.git
    else
        echo1 "Updating $repo"
        (cd $repo && git pull)
    fi
done
echo1 "Packaging tristo-mietitore"
( cd tristo-mietitore && ./bin/mkdist && cp -f ./bin/tm "$SCYTHE_HOME/bin/tm" )
echo1 "Packaging sim-fun-i"
( cd sim-fun-i && ./bin/mkdist && cp -f ./bin/sf "$SCYTHE_HOME/bin/sf" )
echo1 "Packaging scythe-viewer"
( cd scythe-viewer && ./bin/mkdist && cp -f ./bin/zv "$SCYTHE_HOME/bin/zv" )
echo1 "Installed tools"
( cd "$SCYTHE_HOME/bin/" && ls -l {tm,sf,zv} )

echo1 "Creating 'scythe/tmtest' docker image"
(
mkdir ./docker
cp "$SCYTHE_HOME/Dockerfile" ./docker
cp ./tristo-mietitore/bin/tm docker
cp ./sim-fun-i/bin/sf docker
cd ./docker
docker build -t scythe/tmtest .
)
