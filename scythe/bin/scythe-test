echo1 "Runnig the test cycle"

if [ -z "$1" ]; then
    docker_cmd=""
    local_cmd="-n"
else
    docker_cmd="tmtest -c /conf.py -u /uploads -r /results.json"
    local_cmd=""
fi

mkdir -p "$HARVEST"
touch "$HARVEST/results.json" #Â this is to allow docker to mount it as a file

if [ -z "$SCYTHE_USE_SANDBOX" ]; then
    echo2 "Executing tests OUT OF THE SANDBOX and generating results"
    sf tmtest $local_cmd -c "$TM_SETTINGS" -u "$HARVEST/uploads" -r "$HARVEST/results.json"
else
    echo2 "Executing tests and generating results"
    docker run -it --rm -v "$HARVEST/uploads":/uploads -v "$TM_SETTINGS":/conf.py:ro -v "$HARVEST/results.json":/results.json scythe/tmtest $docker_cmd
fi
